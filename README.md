# 日経225 CFD リスク計算アプリ

日経225 CFD取引における発注計画とリスク分析を行うPySide6ベースのGUIアプリケーションです。

## 概要

仕掛けレンジを指定することで、以下の情報を自動計算します：

- **注文一覧**: 指定したレンジ内で自動生成される注文の詳細
- **必要証拠金**: 各注文に必要な証拠金の計算
- **任意証拠金**: ロスカット幅を考慮した任意証拠金の計算
- **損益**: 現在値に基づく各注文の損益
- **リスク分析サマリー**: 総注文数、総証拠金、総損益など

## 特徴

- **買い上がり・売り下がり両対応**: 開始価格と終了価格から自動判定
- **柔軟なパラメータ設定**: 値幅、取引数量、ロスカット幅などを自由に設定可能
- **見やすいGUI**: 2ペイン構成でパラメータ設定とリスク分析を同時表示
- **詳細な注文一覧**: 各注文の価格、証拠金、損益を一覧表示

## インストール

### 必要要件

- Python 3.11以上
- uv（パッケージ管理ツール）

### セットアップ

```bash
# リポジトリをクローン
git clone <repository-url>
cd n225-risk-calc

# 依存関係をインストール（uvを使用）
uv sync
```

## 使い方

### アプリケーションの起動

```bash
python main.py
```

### パラメータの入力

GUIウィンドウが開いたら、以下のパラメータを入力します：

1. **開始価格（円）**: 仕掛けレンジの開始価格
   - 例: 40000

2. **終了価格（円）**: 仕掛けレンジの終了価格
   - 例: 41000
   - 開始価格より大きい場合は買い上がり、小さい場合は売り下がり

3. **値幅（円）**: 各注文間の価格差
   - 例: 100

4. **取引数量**: 各注文の取引数量
   - 例: 0.1
   - デフォルト: 0.1

5. **現在値（円）**: 現在の市場価格
   - 例: 39500
   - 損益計算に使用

6. **ロスカットレート（円）**: ロスカット（強制決済）が発生する価格水準
   - 例: 37000

7. **ロスカット幅（円）**: ロスカット計算に使用する価格幅
   - 例: 2139
   - デフォルト: 2139円
   - 目安: 現在値 ÷ 20

### 計算の実行

「計算実行」ボタンをクリックすると、以下が表示されます：

- **リスク分析サマリー**（右ペイン）
  - 取引方向（買い上がり/売り下がり）
  - 総注文数
  - 総発注金額
  - 総必要証拠金
  - 総任意証拠金
  - 総証拠金
  - 平均注文価格
  - 価格レンジ
  - 総損益

- **注文一覧**（下部テーブル）
  - 注文番号
  - 注文価格
  - 発注金額
  - 取引数量
  - 必要証拠金
  - 任意証拠金
  - 損益

### 計算例

**入力例（買い上がり）**:
- 開始価格: 40,000円
- 終了価格: 41,000円
- 値幅: 100円
- 取引数量: 0.1
- 現在値: 39,500円
- ロスカットレート: 37,000円
- ロスカット幅: 2,139円

**結果**:
- 総注文数: 10件
- 注文価格: 40,000円、40,100円、40,200円...40,900円
- 各注文の必要証拠金、任意証拠金、損益を計算

## プロジェクト構成

```
n225-risk-calc/
├── main.py                 # エントリーポイント
├── pyproject.toml          # プロジェクト設定
├── Requirements.md         # 詳細な要件定義書
├── CLAUDE.md              # 開発者向けガイド
├── README.md              # 本ファイル
├── test_order_types.py    # テストコード
└── src/
    ├── models.py          # データモデル
    ├── calculator.py      # リスク計算エンジン
    ├── validator.py       # 入力バリデーション
    ├── formatter.py       # 結果フォーマッター
    ├── constants.py       # 定数定義
    └── gui/
        └── main_window.py # メインウィンドウ
```

## 計算式

### 必要証拠金
```
必要証拠金 = 注文価格 × 取引数量
```

### 任意証拠金（買いポジション）
```
任意証拠金 = max(0, (注文価格 - ロスカット幅 - ロスカットレート) × 数量 × レバレッジ)
レバレッジ = 10倍
```

### 任意証拠金（売りポジション）
```
任意証拠金 = max(0, (ロスカットレート - (注文価格 + ロスカット幅)) × 数量 × レバレッジ)
レバレッジ = 10倍
```

### 損益（買いポジション）
```
損益 = (現在値 - 注文価格) × 数量 × レバレッジ
```

### 損益（売りポジション）
```
損益 = (注文価格 - 現在値) × 数量 × レバレッジ
```

## テスト

```bash
# 注文タイプのテストを実行
python test_order_types.py
```

## 技術スタック

- **Python**: 3.11+
- **GUI フレームワーク**: PySide6 (Qt for Python)
- **パッケージ管理**: uv

## 今後の拡張予定

詳細は[Requirements.md](Requirements.md)を参照してください。

- CSV出力機能
- チャート表示
- レンジブレイク分析
- 資金効率計算
- 損益シミュレーション

## ライセンス

本プロジェクトは個人使用を目的としています。

## 注意事項

- 本アプリケーションは教育・分析目的で提供されています
- 実際の取引における損益を保証するものではありません
- 投資判断は自己責任で行ってください
- 計算結果の正確性については各自で検証してください

## 開発者向け情報

開発に関する詳細情報は[CLAUDE.md](CLAUDE.md)を参照してください。
