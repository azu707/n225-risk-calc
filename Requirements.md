# 日経225 CFD リスク計算アプリ 要件定義書

## プロジェクト概要
日経225 CFD取引におけるリスク計算を行うアプリケーションを開発する。
ユーザーが指定した仕掛けレンジでの発注計画とリスク分析を提供する。

## 機能要件

### 入力パラメータ
1. **仕掛けレンジ**
   - 開始値（円）
   - 終了値（円）
   - 例: 40,000円〜41,000円

2. **値幅**
   - 各注文間の値幅（円）

3. **取引数量**
   - 各取引の数量（最小単位: 0.1）
   - デフォルト値: 0.1
   - 0.1以上の値を設定可能

4. **証拠金計算**
   - 証拠金 = 注文価格 × 取引数量
   - 例: 40,000円での注文、取引数量0.1 → 証拠金 4,000円

### 出力機能
1. **注文一覧表**
   - 開始値から終了値まで、1発注ごとの金額刻みで注文を生成
   - 各注文の詳細情報を一覧表で表示

2. **表示形式**
   - 金額の桁区切り表示（カンマ区切り）
   - 例: 40,000円、41,000円

### 計算ロジック
1. **注文生成**
   - レンジ = 終了値 - 開始値
   - 注文数 = レンジ ÷ 値幅
   - 各注文価格 = 開始値 + (値幅 × インデックス)

2. **リスク計算**
   - 総発注金額 = 注文数 × 値幅
   - 総証拠金 = 各注文価格の合計 × 取引数量
   - 最大損失想定
   - レンジ外リスク分析

## 非機能要件

### ユーザーインターフェース
- PySide6によるGUIアプリケーション
- 入力バリデーション
- エラーハンドリング

### パフォーマンス
- 即座の計算結果表示
- 大量注文数への対応

### データ形式
- 通貨単位：円
- 数値表示：3桁区切りカンマ
- 小数点：不要（整数のみ）

## 実装プラン

### Phase 1: 基本機能実装
1. **コアロジック開発**
   - 注文計算エンジン
   - リスク計算機能
   - データバリデーション

2. **ユーザーインターフェース**
   - PySide6によるGUI実装
   - 結果表示フォーマット

### Phase 2: 機能拡張
1. **詳細リスク分析**
   - 損益シミュレーション
   - レンジブレイク分析
   - 資金効率計算

2. **出力形式拡張**
   - CSV出力
   - チャート表示（オプション）

### Phase 3: UI改善
1. **PySide6 GUI機能強化**
   - 高度なウィジェット
   - チャート表示
   - テーマ対応

## 技術仕様

### 開発環境
- Python 3.11
- PySide6（GUI フレームワーク）
- パッケージ管理：uv

### アーキテクチャ
```
n225-risk-calc02/
├── main.py              # エントリーポイント
├── src/
│   ├── calculator.py    # リスク計算エンジン
│   ├── validator.py     # 入力バリデーション
│   ├── formatter.py     # 出力フォーマッター
│   ├── models.py        # データモデル
│   └── gui/
│       ├── main_window.py  # メインウィンドウ
│       └── widgets.py      # カスタムウィジェット
├── tests/               # テストコード
└── docs/               # ドキュメント
```

### データ構造
```python
@dataclass
class OrderRange:
    start_price: int     # 開始価格
    end_price: int       # 終了価格
    order_amount: int    # 値幅
    quantity: float      # 取引数量
    
@dataclass
class OrderEntry:
    price: int           # 注文価格
    amount: int          # 発注金額
    quantity: float      # 取引数量
    margin: float        # 必要証拠金
    
@dataclass
class RiskAnalysis:
    total_orders: int    # 総注文数
    total_amount: int    # 総発注金額
    total_margin: float  # 総証拠金
    order_list: List[OrderEntry]
```

## 成功基準
1. 正確な注文計算の実行
2. 適切な桁区切り表示
3. バリデーションエラーの適切な処理
4. 拡張可能なアーキテクチャの実装

## リスク・課題
1. 大量注文時の計算パフォーマンス
2. 入力値の妥当性検証
3. 数値精度の保証
4. エラーハンドリングの網羅性